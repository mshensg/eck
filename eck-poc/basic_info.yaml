---
apiVersion: v1
kind: Namespace
metadata:
  name: eck-demo
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: ebs-gp3
allowVolumeExpansion: true
parameters:
  type: gp3
provisioner: ebs.csi.aws.com
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete
---
apiVersion: v1
kind: Service
metadata:
  name: elasticsearch-internal-https
  namespace: eck-demo
spec:
  ports:
    - name: elasticsearch-https
      protocol: TCP
      port: 9200
      targetPort: 9200
  selector:
    common.k8s.elastic.co/type: elasticsearch
    elasticsearch.k8s.elastic.co/cluster-name: es-eck
    elasticsearch.k8s.elastic.co/node-ingest: "true"
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: kibana-demo-https
  namespace: eck-demo
spec:
  ports:
    - name: kibana-demo-https
      protocol: TCP
      port: 443
      targetPort: 5601
  selector:
    common.k8s.elastic.co/type: kibana
    kibana.k8s.elastic.co/name: kibana-demo
  type: LoadBalancer
---
apiVersion: v1
kind: Service
metadata:
  name: kibana-eck-https
  namespace: eck-demo
spec:
  ports:
    - name: kibana-eck-https
      protocol: TCP
      port: 443
      targetPort: 5601
  selector:
    common.k8s.elastic.co/type: kibana
    kibana.k8s.elastic.co/name: kibana-eck
  type: LoadBalancer
---
apiVersion: v1
kind: Secret
metadata:

  labels:
    common.k8s.elastic.co/type: elasticsearch
    elasticsearch.k8s.elastic.co/cluster-name: es-eck
  name: es-eck-es-monitoring-metricbeat-config
  namespace: eck-demo
type: Opaque
data:
  metricbeat.yml: |-
    metricbeat:
        modules:
            - hosts:
                - https://localhost:9200
              metricsets:
                - ccr
                - core
                - cpu
                - cluster_stats
                - enrich
                - index
                - index_recovery
                - index_summary
                - ingest_pipeline
                - ml_job
                - node
                - node_stats
                - pending_tasks
                - shard
              module: elasticsearch
              password: ci2O4iW688IN42oJG5ztPV37
              period: 10s
              ssl:
                certificate_authorities:
                    - /mnt/elastic-internal/es-monitoring/eck-demo/es-eck/certs/ca.crt
                enabled: true
                verification_mode: certificate
              username: elastic-internal-monitoring
              xpack:
                enabled: true
    output:
        elasticsearch:
            hosts:
                - https://es-eck-es-http.eck-demo.svc:9200
            password: Y6o63350LOexeZ00wzbYH8z9
            ssl:
                certificate_authorities:
                    - /mnt/elastic-internal/es-monitoring-association/eck-demo/es-eck/certs/ca.crt
                verification_mode: certificate
            username: eck-demo-es-eck-eck-demo-es-eck-beat-es-mon-user
    processors:
        - add_cloud_metadata: null
        - add_host_metadata: null
    setup:
        template:
            settings:
                index:
                    mapping:
                        total_fields:
                            limit: 12500
